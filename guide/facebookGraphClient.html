<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4 Facebook Graph Client 0.4.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/configuration.html"><strong>2</strong><span>Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/facebookContext.html"><strong>3</strong><span>Facebook Context</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/facebookGraphClient.html"><strong>4</strong><span>Facebook Graph Client</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/facebookJSTagLib.html"><strong>5</strong><span>Facebook JS Tag Lib</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>The Facebook SDK Plugin allows your Grails application to use the Facebook Platform and develop Facebook apps on Facebook.com or on web sites (with Facebook Connect).
It is a port of the official Facebook PHP SDK V3.1.1 to Grails 2.0.
</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/facebookContext.html">&lt;&lt; <strong>3</strong><span>Facebook Context</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/facebookJSTagLib.html"><strong>5</strong><span>Facebook JS Tag Lib</span> >></a></div>
                


                <div class="project">
                    <h1>4 Facebook Graph Client - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Benoit Hediard</p>

                    <p><strong>Version:</strong> 0.4.1</p>

                    
                </div>

                

                

<h1 id="facebookGraphClient">4 Facebook Graph Client</h1>
To perform Facebook Graph API call, use the <code>FacebookGraphClient</code> without access token for public data or with an access token for private data.
<code>FacebookGraphClient</code> is a thin groovy wrapper around the rock solid <a href="http://restfb.com/" target="blank">RestFB java library</a> .
It will return JSON-based graph objects.<p class="paragraph"/>To play with the API, you might use the grails console from your project root and get user token or app token from <a href="https://developers.facebook.com/tools/access_token/" target="blank">Facebook Access Token Tool</a> .<p class="paragraph"/><div class="code"><pre>grails console</pre></div><p class="paragraph"/><h3>Initialization</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.facebooksdk.FacebookGraphClient<p class="paragraph"/>// For <span class="java&#45;keyword">public</span> data
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient()<p class="paragraph"/>// For <span class="java&#45;keyword">private</span> data (access token required)
def userAccessToken = facebookAppService.getUserAccessToken() // Or any app/user token
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient(userAccessToken)<p class="paragraph"/>// With specific timeout (<span class="java&#45;keyword">default</span> to 180s)
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient(userAccessToken, 90000)<p class="paragraph"/>// With proxy support
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient(userAccessToken, FacebookGraphClient.DEFAULT_READ_TIMEOUT_IN_MS, '192.168.0.10', 8080)</pre></div><p class="paragraph"/><h3>Fetching Single Objects</h3><p class="paragraph"/><div class="code"><pre>def user = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>) // Requires a user access token
def page = facebookClient.fetchObject(<span class="java&#45;quote">"cocacola"</span>)
println <span class="java&#45;quote">"User name: "</span> + user.name
println <span class="java&#45;quote">"Page likes: "</span> + page.likes</pre></div><p class="paragraph"/><h3>Fetching Multiple Objects in One Call</h3><p class="paragraph"/><div class="code"><pre>def fetchObjectsResults = facebookClient.fetchObjects(&#91;<span class="java&#45;quote">"me"</span>, <span class="java&#45;quote">"cocacola"</span>&#93;)
println <span class="java&#45;quote">"User name: "</span> + fetchObjectsResults&#91;<span class="java&#45;quote">"me"</span>&#93;.name
println <span class="java&#45;quote">"Page likes: "</span> + fetchObjectsResults&#91;<span class="java&#45;quote">"cocacola"</span>&#93;.likes</pre></div><p class="paragraph"/><h3>Fetching Connections</h3><p class="paragraph"/><div class="code"><pre>def myFriends = facebookClient.fetchConnection(<span class="java&#45;quote">"me/friends"</span>)
def myFeed = facebookClient.fetchConnection(<span class="java&#45;quote">"me/feed"</span>)
println <span class="java&#45;quote">"Count of my friends: "</span> + myFriends.size()
println <span class="java&#45;quote">"First item in my feed: "</span> + myFeed&#91;0&#93;</pre></div><p class="paragraph"/><h3>Searching</h3><p class="paragraph"/><div class="code"><pre>// Searching is just a special <span class="java&#45;keyword">case</span> of fetching Connections &#45;
// all you have to <span class="java&#45;keyword">do</span> is pass along a few extra parameters.
def publicSearch = facebookClient.fetchConnection(<span class="java&#45;quote">"search"</span>, &#91;q:<span class="java&#45;quote">"watermelon"</span>, type:<span class="java&#45;quote">"post"</span>&#93;)
println <span class="java&#45;quote">"Public search: "</span> + publicSearch&#91;0&#93;.message
// Targeted search
def targetedSearch = facebookClient.fetchConnection(<span class="java&#45;quote">"me/home"</span>, &#91;q:<span class="java&#45;quote">"Mark"</span>, type:<span class="java&#45;quote">"user"</span>&#93;)
println <span class="java&#45;quote">"Posts on my wall by friends named Mark: "</span> + targetedSearch.size()</pre></div><p class="paragraph"/><h3>Fetching Insights</h3><p class="paragraph"/><div class="code"><pre>// Fetching Insights data is as simple as fetching a Connection
def insights = facebookClient.fetchConnection(<span class="java&#45;quote">"PAGE_ID/insights"</span>)
<span class="java&#45;keyword">for</span> (insight in insights) println insight.name</pre></div><p class="paragraph"/><h3>Executing FQL Queries</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;object">String</span> query = <span class="java&#45;quote">"SELECT uid, name FROM user WHERE uid=220439 or uid=7901103"</span>
def users = facebookClient.executeQuery(query)
println <span class="java&#45;quote">"Users: "</span> + users</pre></div><p class="paragraph"/><h3>Executing Multiple FQL Queries in One Call</h3><p class="paragraph"/><div class="code"><pre>Map queries = &#91;users:<span class="java&#45;quote">"SELECT uid, name FROM user WHERE uid=220439 OR uid=7901103"</span>, likers:<span class="java&#45;quote">"SELECT user_id FROM like WHERE object_id=122788341354"</span>&#93;
multiqueryResults = facebookClient.executeMultiquery(queries)
println <span class="java&#45;quote">"Users: "</span> + multiqueryResults.users
println <span class="java&#45;quote">"People who liked: "</span> + multiqueryResults.likers</pre></div><p class="paragraph"/><h3>Metadata/Introspection</h3><p class="paragraph"/><div class="code"><pre>// You can specify metadata=1 <span class="java&#45;keyword">for</span> many calls, not just <span class="java&#45;keyword">this</span> one.
// See the Facebook Graph API documentation <span class="java&#45;keyword">for</span> more details.
def userWithMetadata = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>, &#91;metadata:1&#93;)
println <span class="java&#45;quote">"User connections  "</span> + userWithMetadata.metadata.connections</pre></div><p class="paragraph"/><h3>Passing Parameters</h3><p class="paragraph"/><div class="code"><pre>// You can pass along any parameters you'd like to the Facebook endpoint.
Date oneWeekAgo = <span class="java&#45;keyword">new</span> Date() &#45; 7
def filteredFeed = facebookClient.fetchConnection(<span class="java&#45;quote">"me/feed"</span>, &#91;limit:3, until:<span class="java&#45;quote">"yesterday"</span>, since:oneWeekAgo&#93;)
println <span class="java&#45;quote">"Filtered feed count: "</span> + filteredFeed.size()</pre></div><p class="paragraph"/><h3>Selecting Specific Fields</h3><p class="paragraph"/><div class="code"><pre>def user = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>, &#91;fields:<span class="java&#45;quote">"id, name"</span>&#93;)
println <span class="java&#45;quote">"User name: "</span> + user.name</pre></div><p class="paragraph"/><h3>Publishing a Message and Event</h3><p class="paragraph"/><div class="code"><pre>// Publishing a simple message.
def publishMessageResponse = facebookClient.publish(<span class="java&#45;quote">"me/feed"</span>, &#91;message:<span class="java&#45;quote">"RestFB test"</span>&#93;)
println <span class="java&#45;quote">"Published message ID: "</span> + publishMessageResponse.id<p class="paragraph"/>// Publishing an event
Date tomorrow = <span class="java&#45;keyword">new</span> Date() + 1
Date twoDaysFromNow = <span class="java&#45;keyword">new</span> Date() + 2
def publishEventResponse = facebookClient.publish(<span class="java&#45;quote">"me/events"</span>, &#91;name:<span class="java&#45;quote">"Party"</span>, start_time:tomorrow, end_time:twoDaysFromNow&#93;)
println <span class="java&#45;quote">"Published event ID: "</span> + publishEventResponse.id</pre></div><p class="paragraph"/><h3>Publishing a Photo or a Video</h3><p class="paragraph"/><div class="code"><pre>// Publishing an image to a photo album is easy!
// Just specify the image you'd like to upload and RestFB will handle it from there.
def publishPhotoResponse = facebookClient.publishFile(<span class="java&#45;quote">"me/photos"</span>, &#91;message, <span class="java&#45;quote">"Test cat"</span>&#93;, <span class="java&#45;quote">"/cat.png"</span>)
println <span class="java&#45;quote">"Published photo ID: "</span> + publishPhotoResponse.id
// Publishing a video works the same way.
facebookClient.publish(<span class="java&#45;quote">"me/videos"</span>, &#91;message, <span class="java&#45;quote">"Test cat"</span>&#93;, <span class="java&#45;quote">"/cat.mov"</span>)</pre></div><p class="paragraph"/><h3>Deleting</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;object">Boolean</span> deleted = facebookClient.deleteObject(<span class="java&#45;quote">"some object ID"</span>)
out.println(<span class="java&#45;quote">"Deleted object? "</span> + deleted)</pre></div><p class="paragraph"/><h3>Using the Batch Request API</h3><p class="paragraph"/><div class="code"><pre>List batchResponses = facebookClient.executeBatch(&#91;<span class="java&#45;quote">"me"</span>, <span class="java&#45;quote">"m83music/feed"</span>&#93;);
// Responses are ordered to match up with their corresponding requests.
println <span class="java&#45;quote">"Me object "</span> + batchResponses&#91;0&#93;
println <span class="java&#45;quote">"M83 feed "</span> + batchResponses&#91;1&#93;</pre></div><p class="paragraph"/><h3>Error Handling</h3><p class="paragraph"/>All <code>FacebookClient</code> methods may throw <code>com.restfb.exception.FacebookException</code>, which is an unchecked exception as of RestFB 1.6.<p class="paragraph"/>These are the <code>FacebookException</code> subclasses that you may catch:
<ul class="star">
<li><code>FacebookJsonMappingException</code></li>
<li><code>FacebookNetworkException</code></li>
<li><code>FacebookGraphException</code></li>
<li><code>FacebookOAuthException</code></li>
<li><code>FacebookQueryParseException</code></li>
<li><code>FacebookResponseStatusException</code></li>
</ul><p class="paragraph"/>For more info, check <a href="http://restfb.com/" target="blank">RestFB java library</a> documentation.


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/facebookContext.html">&lt;&lt; <strong>3</strong><span>Facebook Context</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/facebookJSTagLib.html"><strong>5</strong><span>Facebook JS Tag Lib</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Tags/addToPageLink.html">addToPageLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/initJS.html">initJS</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/inviteLink.html">inviteLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/loginLink.html">loginLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/logoutLink.html">logoutLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/picture.html">picture</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/publishLink.html">publishLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/sendLink.html">sendLink</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
